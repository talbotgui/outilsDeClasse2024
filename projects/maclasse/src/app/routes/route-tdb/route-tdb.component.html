@if (periodes.length>0 && eleves.length>0) {
<fieldset class="maclasse-masquerEnModePrint maclasse-filtres">
    <legend>Sélection des filtres</legend>
    <mat-form-field>
        <mat-label>Mode d'affichage</mat-label>
        <mat-select placeholder="Mode d'affichage" [(ngModel)]="modeAffichage" (selectionChange)="onChangementFiltre()">
            <mat-option value="1">Mode préparation</mat-option>
            <mat-option value="2">Mode évaluation</mat-option>
            <mat-option value="3">Mode complet</mat-option>
        </mat-select>
    </mat-form-field>
    <mat-form-field>
        @if (modeAffichage==1){
        <mat-label>Période à préparer</mat-label>
        }@else if (modeAffichage==2 || modeAffichage==3){
        <mat-label>Période à évaluer</mat-label>
        }
        <mat-select placeholder="Période" [(ngModel)]="periodeSelectionnee" (selectionChange)="onChangementFiltre()">
            @for (p of periodes ; track p.id) {
            <mat-option [value]="p">{{p.nom}}</mat-option>
            }
        </mat-select>
    </mat-form-field>
    <mat-form-field>
        <mat-label>Elève</mat-label>
        <mat-select placeholder="Eleve" [(ngModel)]="eleveSelectionne" (selectionChange)="onChangementFiltre()">
            @for (e of eleves ; track e.id) {
            <mat-option [value]="e">{{e.prenom}}</mat-option>
            }
        </mat-select>
    </mat-form-field>
</fieldset>
}
@else {
<p>Vous ne devriez pas tenter d'accéder à cette onglet de l'application sans avoir chargé de données au préalable. Vérifiez votre lien ou votre favori pour en retirer tout ce qui suit le caractère #.
</p>
<p>Vous êtes invité à cliquer sur l'onglet <b>Charger mon année</b></p>
}


@if (lignes && eleveSelectionne && periodeSelectionnee) {
<fieldset class="maclasse-formulaire maclasse-couperEnModePrint">
    <legend>
        <span>Tableau de bord de l'élève {{eleveSelectionne.prenom}} </span>
        @if (modeAffichage==1){
        <span>en préparation de </span>
        }@else if (modeAffichage==2 || modeAffichage==3){
        <span>pour évaluer </span>
        }
        <span>la période {{periodes.indexOf(periodeSelectionnee)+1}}.</span>
    </legend>
    <div>

        @for (ligne of lignes ; track ligne.id ; let idx = $index) {
        <fieldset class="maclasse-formulaire">
            <legend>{{ligne.libelleCompetenceParente}}</legend>
            <div class="maclasse-table">
                <div class="maclasse-table-ligne maclasse-table-entete">
                    <div class="maclasse-table-case maclasse-table-case-w40"></div>
                    <div class="maclasse-table-case maclasse-table-case-w30">Période évaluée</div>
                    <div class="maclasse-table-case maclasse-table-case-w30">Période préparée</div>
                </div>
                <div class="maclasse-table-ligne maclasse-table-entete">
                    <div class="maclasse-table-case maclasse-table-case-w40">Compétence</div>
                    <div class="maclasse-table-case maclasse-table-case-w15">Note</div>
                    <div class="maclasse-table-case maclasse-table-case-w15">Constat</div>
                    <div class="maclasse-table-case maclasse-table-case-w15">Proposition</div>
                    <div class="maclasse-table-case maclasse-table-case-w15">Outil</div>
                </div>
                @for (sousLigne of ligne.sousLignes ; track sousLigne.id ; let idy = $index) {
                <div class="maclasse-table-ligne">
                    <div class="maclasse-table-case maclasse-table-case-w40">
                        <p>{{sousLigne.libelleCompetence}}</p>
                    </div>
                    <div class="maclasse-table-case maclasse-table-case-w15">
                        <p>{{sousLigne.notePeriodePrecedente?.valeur}}</p>
                    </div>
                    <div class="maclasse-table-case maclasse-table-case-w15">
                        <p>{{sousLigne.notePeriodePrecedente?.constat}}</p>
                    </div>
                    <div class="maclasse-table-case maclasse-table-case-w15">
                        <p>{{sousLigne.notePeriodeSuivante?.proposition}}</p>
                    </div>
                    <div class="maclasse-table-case maclasse-table-case-w15">
                        <p>{{sousLigne.notePeriodeSuivante?.outil}}</p>
                    </div>
                </div>
                }
            </div>
        </fieldset>
        }

    </div>
</fieldset>
}